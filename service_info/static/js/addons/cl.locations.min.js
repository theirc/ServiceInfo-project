/*!
 * @author      Angelo Dini - github.com/finalangel/classjs-plugins
 * @copyright   Distributed under the BSD License.
 * @version     3.1.0
 */
var Cl=window.Cl||{};(function(e){"use strict";Cl.Locations=new Class({options:{edit_mode:false,mapType:"",mapTypeControlOptions:google.maps.MapTypeControlStyle.DROPDOWN_MENU,markers:[],markerAnimation:google.maps.Animation.DROP,routePlanner:false,settings:{},zoom:12,zoomControlOptions:google.maps.ZoomControlStyle.SMALL,cls:{mapContainer:".aldryn-locations-container",formContainer:".aldryn-locations-form",formOutput:".aldryn-locations-form-output"}},initialize:function(t,n){this.container=e(t);this.options=e.extend(true,{},this.options,n);this.settings=this.options.settings;this.markers=[];this.bounds=new google.maps.LatLngBounds;this.form=this.container.find(this.options.cls.formContainer);this.mapTypes={hybrid:google.maps.MapTypeId.HYBRID,roadmap:google.maps.MapTypeId.ROADMAP,satellite:google.maps.MapTypeId.SATELLITE,terrain:google.maps.MapTypeId.TERRAIN};this._setup()},_setup:function(){this.settings.mapTypeId=this.mapTypes[this.options.mapType];this.settings.zoomControlOptions={style:this.options.zoomControlOptions};this.settings.mapTypeControlOptions={style:this.options.mapTypeControlOptions};this.mapContainer=this.container.find(this.options.cls.mapContainer)[0];this.map=new google.maps.Map(this.mapContainer,this.settings);this.addMarkers(this.options.markers);this._routePlanner()},addMarkers:function(e){function n(e){var n=new google.maps.Geocoder;n.geocode({address:e.address},function(n,r){if(r===google.maps.GeocoderStatus.OK){e.latlng=n[0].geometry.location;t.addMarker(e)}})}var t=this;for(var r=0;r<e.length;r++){var i=e[r];if(i.latlng===null){n(i)}else{i.latlng=new google.maps.LatLng(i.latlng);this.addMarker(i)}}},addMarker:function(e){var t=this;e=new google.maps.Marker({map:this.map,admin:e.admin,position:e.latlng,title:e.title,content:e.content});if(e.content){var n=new google.maps.InfoWindow({disableAutoPan:true,content:e.content});google.maps.event.addListener(e,"click",function(){n.open(t.map,e);e.setAnimation(google.maps.Animation.BOUNCE);setTimeout(function(){e.setAnimation(null)},750)});setTimeout(function(){n.open(t.map,e)},500)}if(this.options.edit&&window.CMS){google.maps.event.addListener(e,"dblclick",function(){var t=new CMS.Modal;t.open(e.admin,"Location")})}this.markers.push(e);this.bounds.extend(e.position);this.map.fitBounds(this.bounds);this.map.panBy(0,-50);var r=google.maps.event.addListener(t.map,"idle",function(){if(t.map.getZoom()>t.options.zoom){t.map.setZoom(t.options.zoom)}google.maps.event.removeListener(r)})},_routePlanner:function(){function u(){var e=t.form.find('input[type="text"]').val();t.map.getStreetView().setVisible(false);var i={origin:e,destination:r,travelMode:google.maps.TravelMode[n.toUpperCase()]};s.route(i,function(e,n){if(n===google.maps.DirectionsStatus.OK){o.setMap(t.map);o.setDirections(e);t.form.find(".form-group").removeClass("has-error")}else{t.form.find(".form-group").addClass("has-error")}})}var t=this;var n="";var r=this.form.find('input[type="hidden"]').val();var i=this.container.find("span[data-type]");var s=new google.maps.DirectionsService;var o=new google.maps.DirectionsRenderer;o.setMap(this.map);o.setPanel(this.container.find(this.options.cls.formOutput)[0]);i.on("click",function(){i.removeClass("active");e(this).addClass("active");n=e(this).data("type")}).eq(0).trigger("click");this.form.on("submit",function(e){e.preventDefault();u()})}})})(jQuery)